<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>ONEIMG</title>
 	<script src="hco.js" type="text/javascript" charset="utf-8"></script>
	<script src="alloy_finger.js" type="text/javascript" charset="utf-8"></script>
	<script src='axios.js' type="text/javascript" charset="utf-8"></script>
	<script src="vue.js" type="text/javascript" charset="utf-8"></script>

	<style>
	body{
		padding: 0;
		margin: 0;
	}
	.app{
		
		width: 95%;
    	margin: 0 auto;
    	transition:all 0.1s;
	}

	.img-box-w{
	box-shadow: 0 3px 1px -2px rgba(0,0,0,.2), 0 2px 2px 0 rgba(0,0,0,.14), 0 1px 5px 0 rgba(0,0,0,.12);
    background: #fff;
    overflow: hidden;
    position: relative;
	margin: 12px 0;

	}
	.img-box{
		position: relative;
	}
	.img{
		width: 100%;
		height: 100%;
	}
	.title{
		padding: 0 8px;
	}
	.right{
		float: right;
	}
	.top{
		overflow: hidden;
		position: absolute;
	    transform: translateY(-110px);
	    width: 100%;
	    z-index: 8;
	    background-color: #fff;
	    top: 0;
	    transition:transform 0.1s;
	}

	.cssload-thecube {
	width: 40px;
    height: 40px;
	margin: 20px auto;

	position: relative;
	transform: rotateZ(45deg);
		-webkit-transform: rotateZ(45deg);
}
.cssload-thecube .cssload-cube {
	position: relative;
	transform: rotateZ(45deg);
		-webkit-transform: rotateZ(45deg);
}
.cssload-thecube .cssload-cube {
	float: left;
	width: 50%;
	height: 50%;
	position: relative;
	transform: scale(1.1);
		-webkit-transform: scale(1.1);
}
.cssload-thecube .cssload-cube:before {
	content: "";
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	background-color: rgba(240,96,137,0.98);
	animation: cssload-fold-thecube 2.76s infinite linear both;
		-webkit-animation: cssload-fold-thecube 2.76s infinite linear both;
	transform-origin: 100% 100%;
		-webkit-transform-origin: 100% 100%;
}
.cssload-thecube .cssload-c2 {
	transform: scale(1.1) rotateZ(90deg);
		-webkit-transform: scale(1.1) rotateZ(90deg);
}
.cssload-thecube .cssload-c3 {
	transform: scale(1.1) rotateZ(180deg);
		-webkit-transform: scale(1.1) rotateZ(180deg);
}
.cssload-thecube .cssload-c4 {
	transform: scale(1.1) rotateZ(270deg);
		-webkit-transform: scale(1.1) rotateZ(270deg);
}
.cssload-thecube .cssload-c2:before {
	animation-delay: 0.35s;
		-webkit-animation-delay: 0.35s;
}
.cssload-thecube .cssload-c3:before {
	animation-delay: 0.69s;
		-webkit-animation-delay: 0.69s;
}
.cssload-thecube .cssload-c4:before {
	animation-delay: 1.04s;
		-webkit-animation-delay: 1.04s;
}

@keyframes bounceIn {
			  from, 20%, 40%, 60%, 80%, to {
			    animation-timing-function: cubic-bezier(0.215, 0.610, 0.355, 1.000);
			  }
			
			  0% {
			    opacity: 0;
			    transform: scale3d(.3, .3, .3);
			  }
			
			  20% {
			    transform: scale3d(1, 1, 1);
			  }
			
			  40% {
			    transform: scale3d(.93, .93, .93);
			  }
			
			  60% {
			    opacity: 1;
			    transform: scale3d(1, 1, 1);
			  }
			
			  80% {
			    transform: scale3d(.97, .97, .97);
			  }
			
			  to {
			    opacity: 0.1;
			    transform: scale3d(1, 1, 1);
			  }
			}

@keyframes cssload-fold-thecube {
	0%, 10% {
		transform: perspective(136px) rotateX(-180deg);
		opacity: 0;
	}
	25%,
				75% {
		transform: perspective(136px) rotateX(0deg);
		opacity: 1;
	}
	90%,
				100% {
		transform: perspective(136px) rotateY(180deg);
		opacity: 0;
	}
}

@-webkit-keyframes cssload-fold-thecube {
	0%, 10% {
		-webkit-transform: perspective(136px) rotateX(-180deg);
		opacity: 0;
	}
	25%,
				75% {
		-webkit-transform: perspective(136px) rotateX(0deg);
		opacity: 1;
	}
	90%,
				100% {
		-webkit-transform: perspective(136px) rotateY(180deg);
		opacity: 0;
	}
}

.zhe{
	opacity: 0;
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
    height: 100%;
    line-height: 190px;
	text-align: center;	
	background-color: rgba(0,0,0,0.68);
	color: #FDFDFD;
	animation: bounceIn 2s;
}
.zhe-m{
	position: absolute;
	left: 50%;
	top: 50%;
	transform: translate(-50%,-50%);
}
.zhe img {
	vertical-align: middle;
	height: 40px;
	width: 40px;
	margin-right: 10px;
	position: relative;
    top: -2px;
}
img.islove {
    position: absolute;
    top: 6px;
    left: 6px;
    width: 14px;
    height: 14px;
}
.join{
		    	animation: join 1s;
        		-webkit-animation:join 1s;
		    }
		    .out{
		    	animation: out 1s;
        		-webkit-animation:out 1s;
		    }
		    @keyframes join{
		    0% {transform:translateX(100%)}
		    to {}
		    }
		    @-webkit-keyframes join
		    {
		    0% {-webkit-transform:translateX(100%)}
		    to {}
		    }
		    @keyframes out{
		    from {transform:translateX(0)}
		    to {transform:translateX(100%)}
		    }
		    @-webkit-keyframes out{
		    from {-webkit-transform:translateX(0)}
		    to {-webkit-transform:translateX(100%)}
		    }
.right-menu{
		    	display: none;
		    	position: fixed;
		    	width: 100%;
		    	height: 100%;
		    	top: 0;
		    	left: 0;
		    	z-index: 100;
        		background-color: #FFF;
        		overflow-y: scroll;
    			overflow-x: hidden;
		    }
.full{
				position: fixed;
		        background-color: rgb(216, 87, 87);
		        top: 0;
		        left: 0;
		        height: 100%;
		        width: 100%;
		        text-align: center;
		        padding-top: 30%;
		        z-index: 999;
			}
			.full-sms{
		        color: #fff;
		    }
		    .nav{
		    	position: fixed;
		    	top: 0;
		    	left: 0;
		    	width: 100%;
				height: 60px;
				background-color: #fd5e5e;
				z-index: 200;
				box-shadow: 0 2px 5px rgba(0,0,0,.26);
		    }
		    .content{
		    	position: relative;
		    	margin-top: 70px;
		    	
		    }

		    .nav-title{
		    	color: #fff;
			    font-size: 20px;
			    line-height: 60px;
		    }
		    .setico{
		    	 position: absolute;
			    right: 0;
			    top: 21px;
			    height: 21px;
			    width: 21px;
			    padding-right: 20px;
		    }
		    .backico{
		    	vertical-align: middle;
			    padding: 10px;
			    position: relative;
			    top: -2px;
		    }
		    .nav-title>.title{
				padding-left: 10px;
		    }
		    .nav-list{
		    	position: fixed;
		    	top: 60px;
		    	right: 0;
		    	z-index: 999;
		    	list-style: none;
		    	margin: 0px;
		    	background-color: #fefefe;
		    	box-shadow: 0 2px 5px rgba(0,0,0,.26);
		    	padding:8px 20px;
		    	min-width: 90px;
		    }
		    .nav-list>li{
		    	list-style: none;
				font-size: 20px;
				line-height: 40px;
		    }
		    .slide-fade-enter-active {
			  transition: all .3s ease;
			}
			.slide-fade-leave-active {
			  transition: all .3s ease;
			}
			.slide-fade-enter, .slide-fade-leave-to
			/* .slide-fade-leave-active for below version 2.1.8 */ {
			  transform: scale(1,0.4) ;
			  top: 0;
			  opacity: 0;
			}
			.smg-box-b{
				position: fixed;
				top: 0;
				left:0;
				width: 100%;
				height: 100%;
				background-color: rgba(0,0,0,0.2);
				z-index: 200;
			}
			.smg-box {
			    position: fixed;
			    width: 90%;
			    top: 50%;
			    left: 50%;
			    background-color: #fff;
			    transform: translate(-50%,-50%);
			    padding: 15px 24px;
    			box-sizing: border-box;
    			z-index: 300;
			}
.smg-title {
    font-size: 1.3em;
    padding-bottom: 6px;
}
.smg-content{
	line-height: 1.4em;
	    color: #403c3c;
}
.smg-content p{
	margin: 8px 0;
}
span.smg-btn {
    color: #f97575;
    padding-right: 2em;
}
.title{
	line-height: 30px;
}
.title>.right{
	padding-right: 10px;
	padding-left:20px;
}
</style>

</head>
<body>

	<div class="nav-warp">
		<div class="nav">
			<div class="nav-title">
				<img src="back.png" class='backico' v-if='canback' onclick="o.hiddenright()" >
				<span class='title'>一图壁纸</span>
			</div>
			<img class='setico' src="set.png" v-on:click="navlist=!navlist" />
		</div>
		<transition name="slide-fade">
			<ul class="nav-list" v-if='navlist' v-on:click="navlist=false">
				<li v-on:click="smg=set;smg.show=!smg.show">设置</li>
				<li v-on:click="islove=!islove">{{ islove ? '首页' : '收藏' }}</li>
				<li  v-on:click="smg=about;smg.show=!smg.show">关于</li>
			</ul>
		</transition>

		<div class="smg-box-w" v-if='smg.show'>
			<div class="smg-box-b" v-on:click="smg.show=!smg.show"></div>
			<div class="smg-box" >
				<div class="smg-title">{{smg.title}} </div>
				<div class="smg-content" v-html='smg.content'></div>

				<div class="smg-content" v-if='smg.smgmode==1'>
					<!-- 当前模式:{{getsmode(mode)}} -->
					<p style="text-align: right;margin-top:10px"> 
						<span class="smg-btn" onclick='jschangermode(1)'>{{getsmode(1)}}</span>	
						<span class="smg-btn" onclick='jschangermode(2)'>{{getsmode(2)}}</span>
						<span class="smg-btn" onclick='jschangermode(3)'>{{getsmode(3)}}</span>
					</p>
				</div>

				

			</div>
		</div>

	</div>
	<div class="content">
	<div class="full" v-if="full.show">
		<img src="1.gif" style="width: 80px;" />
		<div class="full-sms" v-html='full.sms'></div>
		<div class="loading-foot">oneimg.haotown.cn</div>
	</div>
	<div class="top">
		<div class="cssload-thecube">
			<div class="cssload-cube cssload-c1"></div>
			<div class="cssload-cube cssload-c2"></div>
			<div class="cssload-cube cssload-c4"></div>
			<div class="cssload-cube cssload-c3"></div>
		</div>
	</div>
	<div class="app">
 		<div class="img-box-w"  v-for="item in oneimgarr" v-if="oneimgarr" >
			<div class="img-box" :pid='item.id' :love='item.islove' v-bind:style="{ height: imgheight+'px' }">
				<img class="img" :src="smallapi+item.id"  :onclick="'oneimg('+item.id+')'" >

				<img src="love.png" class="islove" v-if='item.islove'>
			</div>
			<div class="title"><span>ID:{{item.id}}</span><span class="right" :pid='item.id'>评论</span></div>
 		</div>
 		<div class="right-menu">
			<img class="hco-img" :src="smallapi+nowid" style='width: 100%'>
	    	<div class="hco-w"></div>
		</div>
	</div>
	</div>
		

	

	
	
	<script type="text/javascript">
		let scrolllock=false
		
		function orandom(){
			//orandom
			let count=3000; 
			let originalArray=new Array;//原数组 
			//给原数组originalArray赋值 
			for (let i=0;i<count;i++){
				originalArray[i]=i+1 
			} 
			originalArray.sort(function(){ return 0.5 - Math.random(); }); 

			return originalArray
		}

		document.addEventListener('scroll',()=>{
			if(!scrolllock)
			if(document.documentElement.clientHeight + (document.documentElement.scrollTop||document.body.scrollTop ) >= document.body.offsetHeight-50) {
				console.log('load')
				scrolllock=true
				app.pushid(5)

			}
			// else if((document.documentElement.scrollTop||document.body.scrollTop)==0){
			// 	console.log('top')
			// 	scrolllock=true

			// }

		})

		

	let o={};
	o.rightmenu=document.querySelector('.right-menu')

	

	o.addlove=function(id){

		app.lovearr.push(id);
		localStorage.setItem('oneimg-love', JSON.stringify(app.lovearr));
	}
	o.dellove=function(id){
		for (var i in app.lovearr) {
			if (app.lovearr[i] == id) {
				app.lovearr.splice(i, 1);
				break;
			}
		}
		localStorage.setItem('oneimg-love', JSON.stringify(app.lovearr));
	}

	o.showright = function () {
		setback(1)
		nav.canback=true
		o.rightmenu=document.querySelector('.right-menu')
		o.srolltop = document.documentElement.scrollTop;
		o.right = true;
		console.log('aaaaa',o.rightmenu)
		o.rightmenu.className = "right-menu join";
		o.rightmenu.style.display = 'block';
		//setback(1);
	};
	o.hiddenright = function () {
		nav.canback=false
		document.documentElement.scrollTop = o.srolltop;
		o.right = false;
		
		o.rightmenu.className = "right-menu out";
		//setback(0);
		setTimeout(function () {
			o.rightmenu.style.display = 'none';
		}, 940);
	};
	new AlloyFinger(document.body, {
	longTap: function longTap(evt) {
		//长按屏幕750ms触发
		
		for (var i in evt.path) {
			if (evt.path[i].className == "img-box") {
				let w=evt.path[i]
				let pid=w.getAttribute("pid")
				let ele=document.createElement('div')
				
				if(w.getAttribute("love")){
					ele.innerHTML = '<div class="zhe-m"><img src="no.png"/>已删除</div>'
					w.setAttribute('love','false')
					o.dellove(pid)
				}else{
					ele.innerHTML = '<div class="zhe-m"><img src="ok.png"/>已收藏</div>'
					w.setAttribute('love','true')
					o.addlove(pid)
				}
				for (let i = app.oneimgarr.length - 1; i >= 0; i--) {
					if(pid==app.oneimgarr[i].id){
						console.log(app.oneimgarr[i])
						app.oneimgarr[i].islove=!app.oneimgarr[i].islove
						break
					}	
				}
				ele.className='zhe'
				w.appendChild(ele)
				break
			}
		}
		
	},touchStart: function (evt) {
		console.log('start',evt.changedTouches[0].pageY);
		o.sy=evt.changedTouches[0].pageY;
		o.sx=evt.changedTouches[0].pageX;
	},
    touchMove: function (evt) {
    	let t=0-(o.sy-evt.changedTouches[0].pageY)
    	console.log('move',t);
    	if(t<80){
    		app.$el.querySelector('.top').style.transform=`translateY(${t-110}px)`;
    		app.$el.style.paddingTop=t+'px'
    	}else{
    		app.$el.querySelector('.top').style.transform=`translateY(0px)`;
    		app.$el.style.paddingTop='74px'
    	}
     },
    touchEnd:  function (evt) { 
    	let t=0-(o.sy-evt.changedTouches[0].pageY)
    	let t2=0-(o.sx-evt.changedTouches[0].pageX)
    	console.log('end',t)
    	if((document.documentElement.scrollTop||document.body.scrollTop)<10){
	    	if(t>80){
	    		app.init()
	    		
	    	}
	    	setTimeout(()=>{
	    		app.$el.querySelector('.top').style.transform=`translateY(-110px)`;
	    		app.$el.style.paddingTop='0px'
	    	},300)
    	}

    	console.log('t2',t2)

    },
	swipe: function swipe(evt) {
		//evt.direction代表滑动的方向
		let t2=0-(o.sx-evt.changedTouches[0].pageX)
		if(evt.direction=='Right'&&t2>80&&o.right){
			o.hiddenright()
		}
		
		//if(swipe.direction=='Right')

	},
	tap: function tap(evt) {
		//点按触发
		for (var i in evt.path) {
			if (evt.path[i].className=='right') {

				let pid=evt.path[i].getAttribute("pid");
				app.nowid=pid;

				

				document.querySelector('.hco-w').innerHTML=''
				new Hco('.hco-w', 'oneimg', app.nowid);
				o.showright();
			}
		}
	}
});

	let app = new Vue({
		  el: '.content',
		  data: {
		  	smallapi:'https://oneimg.haotown.cn/data/small.php?id=',
		  	nowi:0,
		  	imgnumber:0,
		  	randomarr:[],
		    oneimgarr: [],
		    nowid:0,
		    full:{
		    	show:true,
		    	sms:'正在努力加载中'
		    }
		  },
		  methods: {
		  	load(){
		  		axios.get('https://oneimg.haotown.cn/data/')
				  .then(function (response) {
				    this.imgnumber=response.data;
				    console.log('num',this.imgnumber)
				    app.init();
				    app.full.show=false
				  })
				  .catch(function (error) {
				    console.log(error);
				     app.full.sms='网络可能出错了 <br> 请尝试联系ONEIMG.HAOTOWN.CN'
				 });
		  	},
		  	init(){
		  		this.nowi=0;

		  		if (localStorage.getItem("oneimg-love")) {
					this.lovearr = JSON.parse(localStorage.getItem("oneimg-love"));
				} else {
					this.lovearr = new Array();
				}
		  		this.oneimgarr=[];
		  		this.robj=[]
		  		let t;

		  		if(nav.islove){
					console.log('喜欢页面')
					t=this.lovearr.reverse()
				}else{
					t=orandom(this.imgnumber);
				}
		  		
		  		for (let i = 0; i < t.length; i++) {
		  			let islove=false;
		  			for (let x = 0; x < this.lovearr.length; x++) {
		  				if(t[i]==this.lovearr[x]){
		  					islove=true
		  					console.log(t[i],i)
		  					break
		  				}
		  			}
		  			this.robj.push({
		  				id:t[i],
		  				islove:islove
		  			})
		  		}

		  		this.imgheight=document.querySelector('.app').offsetWidth*0.5625
		  		this.pushid(5)
		  	},getnum(){
		  		console.log(this)
		  	},pushid(num){
		  		if(!num){
		  			num=5	
		  		}
		  		for (var i = 0; i < num; i++) {
		  			if(this.robj[this.nowi])
		  			this.oneimgarr.push({
		  				id:this.robj[this.nowi].id,
		  				islove:this.robj[this.nowi].islove
		  			})
		  			this.nowi++	
		  		}

		  		scrolllock=false

		  	}

		  }
		});
		app.load()
		 
		
		let nav = new Vue({
			el:'.nav-warp',
			data:{
				canback:false,
				navlist:false,
				mode:1,
				islove:false,
				smg:{
					show:false,
					smgmode:0
				},
				set:{
					show:false,
					smgmode:1,
					title:'设置',
					content:`<p>模式一 使用启动器设置壁纸 <br>启动器不支持的情况下启用模式二<br>
        模式二 启用图片裁剪后设置  <br>部分设备可能切图卡住 请切图后等待几秒 点击退出即可设置壁纸  <br>
        模式三 直接设置整张图片</p>

        `
				},about:{
					show:false,
					smgmode:3,
					title:'关于',
					content:`<p>最美的壁纸给最美的你 <br>
        一图壁纸是个小型的壁纸网站 <br>
        在这里你可以找到大量的动漫壁纸 <br>
        本站所有资源均来自网络 <br>
        如果对你造成侵权行为，请联系我 <br>
        E-maill:ureygt@gmail.com <br>
        By:疯狂减肥带 <br>
        感谢!</p>
        <p style="text-align: right; margin-top: 10px;">
        <span class="smg-btn" onclick='openurl("https://github.com/haocity")'>GITHUB</span> 
        <span class="smg-btn" onclick='openurl("https://www.haotown.cn")'>BLOG</span> 
        <span class="smg-btn"  onclick='openurl("https://oneimg.haotown.cn")'>WEBSITE</span></p>
					 `
				}
			},watch:{
				islove:()=>{
					app.init()
				}
			},methods: {
				getsmode(i){
					let t;
					if(i==0){
						t='零'
					}else if(i==1){
						t='一'
					}else if(i==2){
						t='二'
					}else if(i==3){
						t='三'
					}else if(i==4){
						t='四'
					}
					return '模式'+t;
				}
			}
		})

function $c(e) {
	return document.querySelector(e);
}
function toastMessage(message) {
	window.control.toastMessage(message);
}
function setback(id) {
	try {
		window.control.setback(id);
	} catch (e) {}
}
function alertMessage(message) {
	alert(message);
}
function startoneimg(url, id) {
	window.control.startoneimg(url, id);
}
function jschangermode(i){
	nav.mode=i;
	nav.smg.show=false
	window.control.jschangermode(i);
}
function openurl(i){
	try{
		nav.smg.show=false
		window.control.openurl(i)
	}catch(e){
		window.location.href=i
	}
	
}

function oneimg(id) {
	app.full.show=true;
	var url = "http://t4.haotown.cn/img/bj@" + id + ".jpg";
	console.log(id);
		try {
			startoneimg(url, id);
		} catch (e) {
			app.full.sms= '<br>不支持的客户端<br><a style="color:#fff;" href="http://www.coolapk.com/apk/cn.haotowm.oneimg.client" target="_blank">下载最新版</a>';
		}
	
}
		
	</script>
	
</body>
</html>